---
// src/pages/writing/[...slug].astro
import { getCollection } from 'astro:content';
import PageLayout from '../../layouts/PageLayout.astro';

// This function runs at build time to find all publications
// and tell Astro to create a page for each one.
export async function getStaticPaths() {
  const writingEntries = await getCollection('writing');
  return writingEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

import CopyForChat from '../../components/CopyForChat.svelte';

const { entry } = Astro.props;
const { Content } = await entry.render(); // This gets the Markdown content

// Format the content specifically for the clipboard
// Use the raw markdown body instead of the rendered Content component
const textForLLM = `
Title: ${entry.data.title}
Authors: ${entry.data.authors}
Year: ${entry.data.year}

---

${entry.body}
`.trim();


const pdfUrl = entry.data.pdfUrl;

// Define actions specific to this page
const pageActions = [];
if (pdfUrl) {
  pageActions.push({
    label: 'Download PDF',
    action: 'openUrl',
    url: pdfUrl
  });
}

---
<PageLayout title={entry.data.title} contextualActions={pageActions}>
  <div class="flex justify-end mb-4">
    <CopyForChat contentToCopy={textForLLM} client:load />
  </div>
  <div class="mb-4 text-sm text-slate-600 dark:text-slate-400">
    <p><strong>Authors:</strong> {entry.data.authors}</p>
    <p><strong>Published:</strong> {entry.data.year}</p>
    {entry.data.journal && <p><strong>Journal:</strong> {entry.data.journal}</p>}
    {entry.data.doi && <p><a href={`http://dx.doi.org/${entry.data.doi}`} target="_blank">DOI: {entry.data.doi}</a></p>}
  </div>
  <Content /> <!-- This renders the main body of the Markdown file -->
</PageLayout>